<!--
  Copyright 2021 The Go Authors. All rights reserved.
  Use of this source code is governed by a BSD-style
  license that can be found in the LICENSE file.
-->

{{define "title"}}
  <title>{{.Query}} - Search Results · pkg.go.dev</title>
{{end}}

{{define "pre-content"}}
  <link href="/static/frontend/search/search.css?version={{.AppVersionLabel}}" rel="stylesheet">
{{end}}

{{define "post-content"}}
  <script>
    loadScript("/static/frontend/search/search.js")
  </script>
{{end}}

{{define "main"}}
  <main class="go-Container">
    <div class="go-Content">
      <h1 class="SearchResults-header">
        Search results for “{{.Query}}”
      </h1>
      <span class="SearchResults-subtitle">
	Found {{len .Results}}
        {{if eq .SearchMode "identifiers"}}
	 matching identifiers (names of constants, variables, types, functions, methods, and fields).
        {{else}}
          modules with matching packages.
        {{end}}
        {{if eq .SearchMode "identifiers"}}
          <a href="/search?q={{.Query}}&limit={{.Pagination.Limit}}">Search instead for packages.</a>
        {{else}}
          <a href="/search?q={{.Query}}&limit={{.Pagination.Limit}}&m=identifiers">Search instead for identifiers.</a>
        {{end}}
      </span>
      <div class="SearchResults-resultCount go-textSubtle">
        {{if gt (len .Results) 0}}
	  {{ $a := print "/search?q=" .Query }}
	  {{if eq .SearchMode "identifiers"}}
	    {{ $a = print $a "&m=identifiers" }}
	  {{end}}
          {{with .Pagination}}
            {{ $p := . }}
            <div class="Pagination-nav">
	      <form class="go-InputGroup" action="{{$a}}" data-gtmc="search form" aria-label="Search for a package" role="search">
		Show
		<select name="limit" class="go-Select js-searchLimit">
		{{range .Limits}}
		  <option value="{{.}}"{{if eq . $p.Limit}} selected{{end}}>{{.}}</option>
		{{end}}
		</select>
		results.
	      </form>
            </div>
          {{end}}
        {{end}}
        <div class="SearchResults-help"><a href="/search-help">Search help</a></div>
      </div>
        {{if eq (len .Results) 0}}
          {{if eq .SearchMode "identifiers"}}
            {{ $r := "symbols" }}
          {{else}}
            {{ $r := "packages" }}
          {{end}}
          {{template "gopher-airplane" "No results found."}}
          {{if eq .SearchMode "identifiers"}}
            <p class="SearchResults-emptyContentMessage">
              Try searching for a package by visiting <a href="https://pkg.go.dev/search?q={{.Query}}">pkg.go.dev/search?q={{.Query}}</a>.
            </p>
          {{else}}
            <p class="SearchResults-emptyContentMessage">
              If you think “{{.Query}}” is a valid package or module, you could try downloading it by visiting <a href="https://pkg.go.dev/{{.Query}}">pkg.go.dev/{{.Query}}</a>.
            </p>
          {{end}}
        {{else if eq .SearchMode "identifiers"}}
          <div>{{/* Containing element is needed to use *-of-type selectors */}}
            {{template "symbol_search" .}}
          </div>
        {{else}}
          <div>{{/* Containing element is needed to use *-of-type selectors */}}
            {{template "grouped_search" .}}
          </div>
        {{end}}
    </div>
  </main>
{{end}}


{{define "grouped_search"}}
  {{$query := .Query}}
  {{range $i, $v := .Results}}
    <div class="SearchSnippet">
      <div class="SearchSnippet-headerContainer">
        <h2 class="SearchSnippet-header">
          <a href="/{{$v.PackagePath}}" data-gtmc="search result" data-gtmv="{{$i}}"
              data-test-id="snippet-title">
            <span class="SearchSnippet-header-name">{{$v.Name}}</span>
            {{$v.PackagePath}}
          </a>
        </h2>
        {{with $v.ChipText}}<span class="go-Chip go-Chip--inverted">{{.}}</span>{{end}}
      </div>
      <p class="SearchSnippet-synopsis" data-test-id="snippet-synopsis">
        {{$v.Synopsis}}
      </p>
      {{template "search_metadata" $v}}
      {{with .SameModule}}
        <div class="SearchSnippet-sub go-textSubtle">
          <span>{{.Heading}}</span>
          {{range $i, $v := .Links}}
            <a class="go-Chip go-Chip--highlighted js-sameModChip"
                href="/{{$v.Href}}"
                {{if gt $i 4 }}data-hidden="true"{{end}}
                data-gtmc="search result same module"
                data-gtmv="{{$i}}">
              {{$v.Body}}
            </a>
          {{end}}
          {{$more := subtract (len .Links) 5}}
          {{if gt (len .Links) 5}}
            <button class="go-Chip go-Chip--highlighted js-showMoreChip"
                data-gtmc="search result same module" data-gtmv="{{$i}}">
              +{{$more}} more
            </button>
          {{end}}
        </div>
      {{end}}
      {{with .OtherMajor}}
        <div class="SearchSnippet-sub go-textSubtle">
          <span>{{.Heading}}</span>
          {{range $i, $v := .Links}}
            <a class="go-Chip go-Chip--highlighted" href="/{{$v.Href}}"
                data-gtmc="search result lower major" data-gtmv="{{$i}}">{{$v.Body}}</a>
          {{end}}
        </div>
      {{end}}
    </div> <!-- SearchSnippet -->
  {{end}}
{{end}}

{{define "search_metadata"}}
  <div class="SearchSnippet-infoLabel">
    <a href="/{{$.PackagePath}}?tab=importedby" aria-label="Go to Imported By">
       <span class="go-textSubtle">Imported by </span><strong>{{.NumImportedBy}}</strong>
    </a>
    <span class="go-textSubtle">|</span>
    <span class="go-textSubtle">
      {{.DisplayVersion}} published on <span data-test-id="snippet-published">{{.CommitTime}}</span>
    </span>
    <span class="go-textSubtle">|</span>
    <span data-test-id="snippet-license">
    {{if .Licenses}}
      <a href="/{{$.PackagePath}}?tab=licenses" aria-label="Go to Licenses">
        {{commaseparate .Licenses}}
      </a>
    {{else}}
      <span class="go-textSubtle">No license</span>
    {{end}}
    </span>
  </div>
{{end}}
